<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>So it begins!</title>
  <script type="text/javascript" src="main.js"></script>
</head>

<body>
    <div id="myapp"></div>
</body>

<script type="text/javascript">

// Start the Elm application.
var app = Elm.Main.init({
  node: document.getElementById('myapp')
});

// To decouple player logic from world logic,
// we update the world parameters here outside of elm realm.
var intervalID = window.setInterval(myCallback, 2000);

var oldTime = Date.now();
function myCallback() {
  let newTime = Date.now(); 
  let elapsed = newTime - oldTime;

  var socket = new WebSocket('ws://localhost:8765'); 
  socket.addEventListener('open', function (event) {
      socket.send('{}');
  });
  socket.addEventListener('message', function (event) {
    var data = JSON.parse(event.data); 
    app.ports.messageReceiver.send(JSON.stringify(data));
  });
  socket.addEventListener('error', function (event) {
    var data = { "status": "fail" };
    app.ports.messageReceiver.send(JSON.stringify(data));
  });
}

</script>

</html>
